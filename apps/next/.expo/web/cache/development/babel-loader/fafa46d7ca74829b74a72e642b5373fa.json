{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { serverSideTranslations } from \"next-i18next/serverSideTranslations\";\nimport React, { useContext, useEffect, useMemo, useState } from \"react\";\nimport { CompositionAppBody } from \"../../src/components/Compositions\";\nimport PageContentWrapper from \"../../src/components/PageContentWrapper\";\nimport Redirect from \"../../src/components/Redirect\";\nimport SupportSection from \"../../src/components/SupportSection\";\nimport PortraitIcon from \"../../src/style/svgs/portrait.svg\";\nimport { toOffers, toRequests } from \"../../src/components/SupportSection/mapper\";\nimport VerifySection from \"../../src/components/VerifySection/VerifySection\";\nimport { useOffersList } from \"../../src/queries/useOffersList\";\nimport { useRequestsList } from \"../../src/queries/useRequestsList\";\nimport { AuthContext } from \"../_app\";\nimport EmailVerificationModal from \"../../src/components/EmailVerificationModal\";\nimport { Authorization } from \"../../src/hooks/useAuth\";\nimport { useRouter } from \"next/router\";\nimport { useTimer } from \"react-timer-hook\";\nimport ConfirmRejectModal from \"../../src/components/ConfirmRejectModal\";\nimport { MODAL_STATUS } from \"../../src/components/ConfirmRejectModal/constants\";\nimport Toast from \"../../src/components/Toast\";\nimport { useTheme } from \"styled-components\";\nimport { useProgressToastContext } from \"../../src/providers/ProgressToastProvider\";\nimport { useTranslation } from \"react-i18next\";\nimport Spinner from \"../../src/components/Spinner\";\nvar bottomMarginStyle = {\n  marginBottom: 20\n};\n\nfunction DashboardContent() {\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useProgressToastCont = useProgressToastContext(),\n      isProgressToastVisible = _useProgressToastCont.isProgressToastVisible,\n      actions = _useProgressToastCont.actions;\n\n  var theme = useTheme();\n\n  var _useContext = useContext(AuthContext),\n      account = _useContext.account,\n      loaded = _useContext.loaded,\n      identity = _useContext.identity;\n\n  var router = useRouter();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      sendVerificationEmailError = _useState2[0],\n      setSendVerificationEmailError = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      emailModalVisible = _useState4[0],\n      setEmailModalVisible = _useState4[1];\n\n  var _useTimer = useTimer({\n    expiryTimestamp: new Date(),\n    autoStart: false,\n    onExpire: function onExpire() {\n      return sendVerificationEmailError ? setSendVerificationEmailError(false) : \"\";\n    }\n  }),\n      seconds = _useTimer.seconds,\n      isRunning = _useTimer.isRunning,\n      restart = _useTimer.restart;\n\n  var restartTimer = function restartTimer() {\n    var time = new Date();\n    time.setSeconds(time.getSeconds() + 30);\n    restart(time);\n  };\n\n  var _useOffersList = useOffersList(),\n      offersDTO = _useOffersList.data,\n      isOffersInError = _useOffersList.isError,\n      isOffersLoading = _useOffersList.isLoading;\n\n  var _useRequestsList = useRequestsList(),\n      requestsDTO = _useRequestsList.data,\n      isRequestsInError = _useRequestsList.isError,\n      isRequestsLoading = _useRequestsList.isLoading;\n\n  var showEmailVerificationModal = function showEmailVerificationModal() {\n    return _regeneratorRuntime.async(function showEmailVerificationModal$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!identity) {\n              _context.next = 9;\n              break;\n            }\n\n            if (!(identity != null && identity.email)) {\n              _context.next = 8;\n              break;\n            }\n\n            if (isRunning) {\n              _context.next = 5;\n              break;\n            }\n\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(sendVerificationEmail());\n\n          case 5:\n            setEmailModalVisible(true);\n            _context.next = 9;\n            break;\n\n          case 8:\n            router.push(\"user-profile\");\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var sendVerificationEmail = function sendVerificationEmail() {\n    return _regeneratorRuntime.async(function sendVerificationEmail$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!identity) {\n              _context2.next = 3;\n              break;\n            }\n\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(Authorization.sendVerificationEmail(identity).catch(function () {\n              return setSendVerificationEmailError(true);\n            }));\n\n          case 3:\n            restartTimer();\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var offers = useMemo(function () {\n    return offersDTO ? toOffers(offersDTO) : undefined;\n  }, [offersDTO]);\n  var requests = useMemo(function () {\n    return requestsDTO ? toRequests(requestsDTO) : undefined;\n  }, [requestsDTO]);\n  var isOffersChangeInProgress = useMemo(function () {\n    return offers == null ? void 0 : offers.some(function (offer) {\n      return offer.clientOnly;\n    });\n  }, [offers]);\n  var isRequestChangeInProgress = useMemo(function () {\n    return requests == null ? void 0 : requests.some(function (request) {\n      return request.clientOnly;\n    });\n  }, [requests]);\n  var needEmailVerification = account !== undefined && account !== null && !account.confirmedEmail;\n  var needPhoneVerification = account !== undefined && account !== null && !account.confirmedPhone;\n  var needBackendAccountCreation = account ? false : true;\n  var readonly = needEmailVerification || needPhoneVerification || needBackendAccountCreation;\n  useEffect(function () {\n    if (!isOffersChangeInProgress && !isRequestChangeInProgress) {\n      actions.hideProgressToast();\n    }\n  }, [isOffersChangeInProgress, isRequestChangeInProgress, actions]);\n  return React.createElement(CompositionAppBody, null, React.createElement(PageContentWrapper, {\n    outerStyles: {\n      paddingHorizontal: 16\n    }\n  }, React.createElement(React.Fragment, null, React.createElement(VerifySection, {\n    emailOnPress: showEmailVerificationModal,\n    needEmail: needEmailVerification,\n    needPhone: needPhoneVerification,\n    needAccount: needBackendAccountCreation,\n    containerStyle: [{\n      marginTop: 20\n    }, bottomMarginStyle]\n  }), isProgressToastVisible && React.createElement(Toast, {\n    icon: React.createElement(PortraitIcon, null),\n    color: theme.colors.accent,\n    label: t(\"others:desktop.checks.changesInProgress\"),\n    contaierStyle: {\n      marginBottom: 10\n    }\n  }), React.createElement(SupportSection, {\n    readonly: readonly,\n    offers: offers,\n    isOffersInError: loaded && !isOffersLoading && isOffersInError,\n    isOffersLoading: !loaded || isOffersLoading,\n    requests: requests,\n    isRequestsInError: loaded && !isRequestsLoading && isRequestsInError,\n    isRequestsLoading: !loaded || isRequestsLoading\n  }), React.createElement(ConfirmRejectModal, {\n    status: MODAL_STATUS.ACCEPT\n  }), React.createElement(ConfirmRejectModal, {\n    status: MODAL_STATUS.REJECT\n  })), emailModalVisible ? React.createElement(EmailVerificationModal, {\n    onClose: function onClose() {\n      return setEmailModalVisible(false);\n    },\n    seconds: seconds,\n    restartTimer: sendVerificationEmail,\n    error: sendVerificationEmailError\n  }) : React.createElement(React.Fragment, null)));\n}\n\nexport default function Dashboard() {\n  var _useContext2 = useContext(AuthContext),\n      identity = _useContext2.identity,\n      loaded = _useContext2.loaded;\n\n  if (!loaded) {\n    return React.createElement(Spinner, null);\n  }\n\n  if (!identity && loaded) return React.createElement(Redirect, {\n    path: \"/signin\"\n  });\n  return React.createElement(DashboardContent, null);\n}\nexport var getServerSideProps = function getServerSideProps(_ref) {\n  var locale;\n  return _regeneratorRuntime.async(function getServerSideProps$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          locale = _ref.locale;\n          _context3.t0 = _objectSpread;\n          _context3.t1 = {};\n          _context3.t2 = locale;\n\n          if (!_context3.t2) {\n            _context3.next = 8;\n            break;\n          }\n\n          _context3.next = 7;\n          return _regeneratorRuntime.awrap(serverSideTranslations(locale));\n\n        case 7:\n          _context3.t2 = _context3.sent;\n\n        case 8:\n          _context3.t3 = _context3.t2;\n          _context3.t4 = (0, _context3.t0)(_context3.t1, _context3.t3);\n          return _context3.abrupt(\"return\", {\n            props: _context3.t4\n          });\n\n        case 11:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};","map":{"version":3,"sources":["/Users/stanislav.kovalov/Desktop/uasos/apps/next/pages/dashboard/index.tsx"],"names":["serverSideTranslations","React","useContext","useEffect","useMemo","useState","CompositionAppBody","PageContentWrapper","Redirect","SupportSection","PortraitIcon","toOffers","toRequests","VerifySection","useOffersList","useRequestsList","AuthContext","EmailVerificationModal","Authorization","useRouter","useTimer","ConfirmRejectModal","MODAL_STATUS","Toast","useTheme","useProgressToastContext","useTranslation","Spinner","bottomMarginStyle","marginBottom","DashboardContent","t","isProgressToastVisible","actions","theme","account","loaded","identity","router","sendVerificationEmailError","setSendVerificationEmailError","emailModalVisible","setEmailModalVisible","expiryTimestamp","Date","autoStart","onExpire","seconds","isRunning","restart","restartTimer","time","setSeconds","getSeconds","offersDTO","data","isOffersInError","isError","isOffersLoading","isLoading","requestsDTO","isRequestsInError","isRequestsLoading","showEmailVerificationModal","email","sendVerificationEmail","push","catch","offers","undefined","requests","isOffersChangeInProgress","some","offer","clientOnly","isRequestChangeInProgress","request","needEmailVerification","confirmedEmail","needPhoneVerification","confirmedPhone","needBackendAccountCreation","readonly","hideProgressToast","paddingHorizontal","marginTop","colors","accent","ACCEPT","REJECT","Dashboard","getServerSideProps","locale","props"],"mappings":";;;;;;;;AACA,SAASA,sBAAT,QAAuC,qCAAvC;AACA,OAAOC,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,EAAuCC,OAAvC,EAAgDC,QAAhD,QAAgE,OAAhE;AAEA,SAASC,kBAAT;AACA,OAAOC,kBAAP;AACA,OAAOC,QAAP;AACA,OAAOC,cAAP;AACA,OAAOC,YAAP;AACA,SACEC,QADF,EAEEC,UAFF;AAKA,OAAOC,aAAP;AACA,SAASC,aAAT;AACA,SAASC,eAAT;AACA,SAASC,WAAT;AACA,OAAOC,sBAAP;AACA,SAASC,aAAT;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,OAAOC,kBAAP;AACA,SAASC,YAAT;AACA,OAAOC,KAAP;AAGA,SAASC,QAAT,QAAyB,mBAAzB;AACA,SAASC,uBAAT;AACA,SAASC,cAAT,QAA+B,eAA/B;AACA,OAAOC,OAAP;AAEA,IAAMC,iBAAuC,GAAG;AAAEC,EAAAA,YAAY,EAAE;AAAhB,CAAhD;;AAIA,SAASC,gBAAT,GAA4B;AAC1B,wBAAcJ,cAAc,EAA5B;AAAA,MAAQK,CAAR,mBAAQA,CAAR;;AAEA,8BAA4CN,uBAAuB,EAAnE;AAAA,MAAQO,sBAAR,yBAAQA,sBAAR;AAAA,MAAgCC,OAAhC,yBAAgCA,OAAhC;;AACA,MAAMC,KAAK,GAAGV,QAAQ,EAAtB;;AAEA,oBAAsCtB,UAAU,CAACc,WAAD,CAAhD;AAAA,MAAQmB,OAAR,eAAQA,OAAR;AAAA,MAAiBC,MAAjB,eAAiBA,MAAjB;AAAA,MAAyBC,QAAzB,eAAyBA,QAAzB;;AACA,MAAMC,MAAM,GAAGnB,SAAS,EAAxB;;AACA,kBACEd,QAAQ,CAAC,KAAD,CADV;AAAA;AAAA,MAAOkC,0BAAP;AAAA,MAAmCC,6BAAnC;;AAEA,mBAAkDnC,QAAQ,CAAC,KAAD,CAA1D;AAAA;AAAA,MAAOoC,iBAAP;AAAA,MAA0BC,oBAA1B;;AAEA,kBAAwCtB,QAAQ,CAAC;AAC/CuB,IAAAA,eAAe,EAAE,IAAIC,IAAJ,EAD8B;AAE/CC,IAAAA,SAAS,EAAE,KAFoC;AAG/CC,IAAAA,QAAQ,EAAE;AAAA,aACRP,0BAA0B,GAAGC,6BAA6B,CAAC,KAAD,CAAhC,GAA0C,EAD5D;AAAA;AAHqC,GAAD,CAAhD;AAAA,MAAQO,OAAR,aAAQA,OAAR;AAAA,MAAiBC,SAAjB,aAAiBA,SAAjB;AAAA,MAA4BC,OAA5B,aAA4BA,OAA5B;;AAOA,MAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB,QAAMC,IAAI,GAAG,IAAIP,IAAJ,EAAb;AACAO,IAAAA,IAAI,CAACC,UAAL,CAAgBD,IAAI,CAACE,UAAL,KAAoB,EAApC;AACAJ,IAAAA,OAAO,CAACE,IAAD,CAAP;AACD,GAJD;;AAMA,uBAIIrC,aAAa,EAJjB;AAAA,MACQwC,SADR,kBACEC,IADF;AAAA,MAEWC,eAFX,kBAEEC,OAFF;AAAA,MAGaC,eAHb,kBAGEC,SAHF;;AAMA,yBAII5C,eAAe,EAJnB;AAAA,MACQ6C,WADR,oBACEL,IADF;AAAA,MAEWM,iBAFX,oBAEEJ,OAFF;AAAA,MAGaK,iBAHb,oBAGEH,SAHF;;AAMA,MAAMI,0BAA0B,GAAG,SAA7BA,0BAA6B;AAAA;AAAA;AAAA;AAAA;AAAA,iBAC7B1B,QAD6B;AAAA;AAAA;AAAA;;AAAA,kBAE3BA,QAF2B,YAE3BA,QAAQ,CAAE2B,KAFiB;AAAA;AAAA;AAAA;;AAAA,gBAGxBhB,SAHwB;AAAA;AAAA;AAAA;;AAAA;AAAA,6CAGPiB,qBAAqB,EAHd;;AAAA;AAI7BvB,YAAAA,oBAAoB,CAAC,IAAD,CAApB;AAJ6B;AAAA;;AAAA;AAM7BJ,YAAAA,MAAM,CAAC4B,IAAP,CAAY,cAAZ;;AAN6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAnC;;AAWA,MAAMD,qBAAqB,GAAG,SAAxBA,qBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA,iBACxB5B,QADwB;AAAA;AAAA;AAAA;;AAAA;AAAA,6CAEpBnB,aAAa,CAAC+C,qBAAd,CAAoC5B,QAApC,EAA8C8B,KAA9C,CAAoD;AAAA,qBACxD3B,6BAA6B,CAAC,IAAD,CAD2B;AAAA,aAApD,CAFoB;;AAAA;AAM5BU,YAAAA,YAAY;;AANgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA9B;;AASA,MAAMkB,MAAM,GAAGhE,OAAO,CACpB;AAAA,WAAOkD,SAAS,GAAG3C,QAAQ,CAAC2C,SAAD,CAAX,GAAyBe,SAAzC;AAAA,GADoB,EAEpB,CAACf,SAAD,CAFoB,CAAtB;AAIA,MAAMgB,QAAQ,GAAGlE,OAAO,CACtB;AAAA,WAAOwD,WAAW,GAAGhD,UAAU,CAACgD,WAAD,CAAb,GAA6BS,SAA/C;AAAA,GADsB,EAEtB,CAACT,WAAD,CAFsB,CAAxB;AAKA,MAAMW,wBAAwB,GAAGnE,OAAO,CACtC;AAAA,WAAMgE,MAAN,oBAAMA,MAAM,CAAEI,IAAR,CAAa,UAACC,KAAD;AAAA,aAAWA,KAAK,CAACC,UAAjB;AAAA,KAAb,CAAN;AAAA,GADsC,EAEtC,CAACN,MAAD,CAFsC,CAAxC;AAKA,MAAMO,yBAAyB,GAAGvE,OAAO,CACvC;AAAA,WAAMkE,QAAN,oBAAMA,QAAQ,CAAEE,IAAV,CAAe,UAACI,OAAD;AAAA,aAAaA,OAAO,CAACF,UAArB;AAAA,KAAf,CAAN;AAAA,GADuC,EAEvC,CAACJ,QAAD,CAFuC,CAAzC;AAKA,MAAMO,qBAA8B,GAClC1C,OAAO,KAAKkC,SAAZ,IAAyBlC,OAAO,KAAK,IAArC,IAA6C,CAACA,OAAO,CAAC2C,cADxD;AAEA,MAAMC,qBAA8B,GAClC5C,OAAO,KAAKkC,SAAZ,IAAyBlC,OAAO,KAAK,IAArC,IAA6C,CAACA,OAAO,CAAC6C,cADxD;AAEA,MAAMC,0BAA0B,GAAG9C,OAAO,GAAG,KAAH,GAAW,IAArD;AAEA,MAAM+C,QAAQ,GACZL,qBAAqB,IACrBE,qBADA,IAEAE,0BAHF;AAKA9E,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACoE,wBAAD,IAA6B,CAACI,yBAAlC,EAA6D;AAC3D1C,MAAAA,OAAO,CAACkD,iBAAR;AACD;AACF,GAJQ,EAIN,CAACZ,wBAAD,EAA2BI,yBAA3B,EAAsD1C,OAAtD,CAJM,CAAT;AAMA,SACE,oBAAC,kBAAD,QACE,oBAAC,kBAAD;AAAoB,IAAA,WAAW,EAAE;AAAEmD,MAAAA,iBAAiB,EAAE;AAArB;AAAjC,KACE,0CACE,oBAAC,aAAD;AACE,IAAA,YAAY,EAAErB,0BADhB;AAEE,IAAA,SAAS,EAAEc,qBAFb;AAGE,IAAA,SAAS,EAAEE,qBAHb;AAIE,IAAA,WAAW,EAAEE,0BAJf;AAKE,IAAA,cAAc,EAAE,CAAC;AAAEI,MAAAA,SAAS,EAAE;AAAb,KAAD,EAAoBzD,iBAApB;AALlB,IADF,EAYGI,sBAAsB,IACrB,oBAAC,KAAD;AACE,IAAA,IAAI,EAAE,oBAAC,YAAD,OADR;AAEE,IAAA,KAAK,EAAEE,KAAK,CAACoD,MAAN,CAAaC,MAFtB;AAGE,IAAA,KAAK,EAAExD,CAAC,CAAC,yCAAD,CAHV;AAIE,IAAA,aAAa,EAAE;AAAEF,MAAAA,YAAY,EAAE;AAAhB;AAJjB,IAbJ,EAoBE,oBAAC,cAAD;AACE,IAAA,QAAQ,EAAEqD,QADZ;AAEE,IAAA,MAAM,EAAEd,MAFV;AAGE,IAAA,eAAe,EAAEhC,MAAM,IAAI,CAACsB,eAAX,IAA8BF,eAHjD;AAIE,IAAA,eAAe,EAAE,CAACpB,MAAD,IAAWsB,eAJ9B;AAKE,IAAA,QAAQ,EAAEY,QALZ;AAME,IAAA,iBAAiB,EACflC,MAAM,IAAI,CAAC0B,iBAAX,IAAgCD,iBAPpC;AASE,IAAA,iBAAiB,EAAE,CAACzB,MAAD,IAAW0B;AAThC,IApBF,EA+BE,oBAAC,kBAAD;AAAoB,IAAA,MAAM,EAAExC,YAAY,CAACkE;AAAzC,IA/BF,EAgCE,oBAAC,kBAAD;AAAoB,IAAA,MAAM,EAAElE,YAAY,CAACmE;AAAzC,IAhCF,CADF,EAmCGhD,iBAAiB,GAChB,oBAAC,sBAAD;AACE,IAAA,OAAO,EAAE;AAAA,aAAMC,oBAAoB,CAAC,KAAD,CAA1B;AAAA,KADX;AAEE,IAAA,OAAO,EAAEK,OAFX;AAGE,IAAA,YAAY,EAAEkB,qBAHhB;AAIE,IAAA,KAAK,EAAE1B;AAJT,IADgB,GAQhB,yCA3CJ,CADF,CADF;AAkDD;;AAED,eAAe,SAASmD,SAAT,GAAqB;AAClC,qBAA6BxF,UAAU,CAACc,WAAD,CAAvC;AAAA,MAAQqB,QAAR,gBAAQA,QAAR;AAAA,MAAkBD,MAAlB,gBAAkBA,MAAlB;;AAEA,MAAI,CAACA,MAAL,EAAa;AACX,WAAO,oBAAC,OAAD,OAAP;AACD;;AAED,MAAI,CAACC,QAAD,IAAaD,MAAjB,EAAyB,OAAO,oBAAC,QAAD;AAAU,IAAA,IAAI,EAAC;AAAf,IAAP;AAEzB,SAAO,oBAAC,gBAAD,OAAP;AACD;AAED,OAAO,IAAMuD,kBAAsC,GAAG,SAAzCA,kBAAyC;AAAA;AAAA;AAAA;AAAA;AAAA;AAASC,UAAAA,MAAT,QAASA,MAAT;AAAA;AAAA;AAAA,yBAE9CA,MAF8C;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,2CAE7B5F,sBAAsB,CAAC4F,MAAD,CAFO;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACpDC,YAAAA,KADoD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA/C","sourcesContent":["import { GetServerSideProps } from \"next\";\nimport { serverSideTranslations } from \"next-i18next/serverSideTranslations\";\nimport React, { useContext, useEffect, useMemo, useState } from \"react\";\nimport { StyleProp, ViewStyle } from \"react-native\";\nimport { CompositionAppBody } from \"../../src/components/Compositions\";\nimport PageContentWrapper from \"../../src/components/PageContentWrapper\";\nimport Redirect from \"../../src/components/Redirect\";\nimport SupportSection from \"../../src/components/SupportSection\";\nimport PortraitIcon from \"../../src/style/svgs/portrait.svg\";\nimport {\n  toOffers,\n  toRequests,\n} from \"../../src/components/SupportSection/mapper\";\n// import Tags from \"../../src/components/Tags\";\nimport VerifySection from \"../../src/components/VerifySection/VerifySection\";\nimport { useOffersList } from \"../../src/queries/useOffersList\";\nimport { useRequestsList } from \"../../src/queries/useRequestsList\";\nimport { AuthContext } from \"../_app\";\nimport EmailVerificationModal from \"../../src/components/EmailVerificationModal\";\nimport { Authorization } from \"../../src/hooks/useAuth\";\nimport { useRouter } from \"next/router\";\nimport { useTimer } from \"react-timer-hook\";\nimport ConfirmRejectModal from \"../../src/components/ConfirmRejectModal\";\nimport { MODAL_STATUS } from \"../../src/components/ConfirmRejectModal/constants\";\nimport Toast from \"../../src/components/Toast\";\nimport { Theme } from \"../../src/style/theme.config\";\n\nimport { useTheme } from \"styled-components\";\nimport { useProgressToastContext } from \"../../src/providers/ProgressToastProvider\";\nimport { useTranslation } from \"react-i18next\";\nimport Spinner from \"../../src/components/Spinner\";\n\nconst bottomMarginStyle: StyleProp<ViewStyle> = { marginBottom: 20 };\n\n// const fakeTags = [\"Shelter\"];\n\nfunction DashboardContent() {\n  const { t } = useTranslation();\n\n  const { isProgressToastVisible, actions } = useProgressToastContext();\n  const theme = useTheme() as Theme;\n\n  const { account, loaded, identity } = useContext(AuthContext);\n  const router = useRouter();\n  const [sendVerificationEmailError, setSendVerificationEmailError] =\n    useState(false);\n  const [emailModalVisible, setEmailModalVisible] = useState(false);\n\n  const { seconds, isRunning, restart } = useTimer({\n    expiryTimestamp: new Date(),\n    autoStart: false,\n    onExpire: () =>\n      sendVerificationEmailError ? setSendVerificationEmailError(false) : \"\",\n  });\n\n  const restartTimer = () => {\n    const time = new Date();\n    time.setSeconds(time.getSeconds() + 30);\n    restart(time);\n  };\n\n  const {\n    data: offersDTO,\n    isError: isOffersInError,\n    isLoading: isOffersLoading,\n  } = useOffersList();\n\n  const {\n    data: requestsDTO,\n    isError: isRequestsInError,\n    isLoading: isRequestsLoading,\n  } = useRequestsList();\n\n  const showEmailVerificationModal = async () => {\n    if (identity) {\n      if (identity?.email) {\n        if (!isRunning) await sendVerificationEmail();\n        setEmailModalVisible(true);\n      } else {\n        router.push(\"user-profile\");\n      }\n    }\n  };\n\n  const sendVerificationEmail = async () => {\n    if (identity) {\n      await Authorization.sendVerificationEmail(identity).catch(() =>\n        setSendVerificationEmailError(true)\n      );\n    }\n    restartTimer();\n  };\n\n  const offers = useMemo(\n    () => (offersDTO ? toOffers(offersDTO) : undefined),\n    [offersDTO]\n  );\n  const requests = useMemo(\n    () => (requestsDTO ? toRequests(requestsDTO) : undefined),\n    [requestsDTO]\n  );\n\n  const isOffersChangeInProgress = useMemo(\n    () => offers?.some((offer) => offer.clientOnly),\n    [offers]\n  );\n\n  const isRequestChangeInProgress = useMemo(\n    () => requests?.some((request) => request.clientOnly),\n    [requests]\n  );\n\n  const needEmailVerification: boolean =\n    account !== undefined && account !== null && !account.confirmedEmail;\n  const needPhoneVerification: boolean =\n    account !== undefined && account !== null && !account.confirmedPhone;\n  const needBackendAccountCreation = account ? false : true;\n\n  const readonly =\n    needEmailVerification ||\n    needPhoneVerification ||\n    needBackendAccountCreation;\n\n  useEffect(() => {\n    if (!isOffersChangeInProgress && !isRequestChangeInProgress) {\n      actions.hideProgressToast();\n    }\n  }, [isOffersChangeInProgress, isRequestChangeInProgress, actions]);\n\n  return (\n    <CompositionAppBody>\n      <PageContentWrapper outerStyles={{ paddingHorizontal: 16 }}>\n        <>\n          <VerifySection\n            emailOnPress={showEmailVerificationModal}\n            needEmail={needEmailVerification}\n            needPhone={needPhoneVerification}\n            needAccount={needBackendAccountCreation}\n            containerStyle={[{ marginTop: 20 }, bottomMarginStyle]}\n          />\n          {/* {loaded && (\n            <Tags tags={fakeTags} containerStyle={[bottomMarginStyle]} />\n          )} */}\n\n          {isProgressToastVisible && (\n            <Toast\n              icon={<PortraitIcon />}\n              color={theme.colors.accent}\n              label={t(\"others:desktop.checks.changesInProgress\")}\n              contaierStyle={{ marginBottom: 10 }}\n            />\n          )}\n          <SupportSection\n            readonly={readonly}\n            offers={offers}\n            isOffersInError={loaded && !isOffersLoading && isOffersInError}\n            isOffersLoading={!loaded || isOffersLoading}\n            requests={requests}\n            isRequestsInError={\n              loaded && !isRequestsLoading && isRequestsInError\n            }\n            isRequestsLoading={!loaded || isRequestsLoading}\n          />\n          <ConfirmRejectModal status={MODAL_STATUS.ACCEPT} />\n          <ConfirmRejectModal status={MODAL_STATUS.REJECT} />\n        </>\n        {emailModalVisible ? (\n          <EmailVerificationModal\n            onClose={() => setEmailModalVisible(false)}\n            seconds={seconds}\n            restartTimer={sendVerificationEmail}\n            error={sendVerificationEmailError}\n          />\n        ) : (\n          <></>\n        )}\n      </PageContentWrapper>\n    </CompositionAppBody>\n  );\n}\n\nexport default function Dashboard() {\n  const { identity, loaded } = useContext(AuthContext);\n\n  if (!loaded) {\n    return <Spinner />;\n  }\n\n  if (!identity && loaded) return <Redirect path=\"/signin\" />;\n\n  return <DashboardContent />;\n}\n\nexport const getServerSideProps: GetServerSideProps = async ({ locale }) => ({\n  props: {\n    ...(locale && (await serverSideTranslations(locale))),\n  },\n});\n"]},"metadata":{},"sourceType":"module"}