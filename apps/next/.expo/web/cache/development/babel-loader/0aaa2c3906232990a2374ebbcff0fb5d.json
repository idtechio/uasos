{"ast":null,"code":"import _taggedTemplateLiteralLoose from \"@babel/runtime/helpers/taggedTemplateLiteralLoose\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _templateObject;\n\nvar _excluded = [\"label\"],\n    _excluded2 = [\"label\"],\n    _excluded3 = [\"label\"],\n    _excluded4 = [\"label\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport styled from \"styled-components/native\";\nimport { Nationality } from \"../../helpers/FormTypes\";\nimport { useAddGuestToApi, useUpdateGuestToApi } from \"../../queries/useRequestsList\";\nimport { ButtonCta } from \"../Buttons\";\nimport CardModal from \"../CardModal\";\nimport { CompositionSection } from \"../Compositions\";\nimport { ChoiceButton, InputControl, InputCotrolLabel } from \"../Forms\";\nimport { Buttons } from \"../Forms/RadioButtons/style\";\nimport FormButtonsVertical from \"../Inputs/FormButtonsVertcal\";\nimport FormCityDropdown from \"../Inputs/FormCityDropdown\";\nimport FormCountryDropdown from \"../Inputs/FormCountryDropdown\";\nimport FormDropdown from \"../Inputs/FormDropdown\";\nimport FormNumericInput from \"../Inputs/FormNumericInput\";\nimport FormRadioGroup from \"../Inputs/FormRadioGroup\";\nimport { Error as InputError } from \"../Inputs/style\";\nimport { ThankfulnessModal } from \"../ThankfulnessModal\";\nimport { Tooltip } from \"../Tooltip\";\nimport { ACCOMMODATION_TYPES, GROUP_RELATIONS, OVERNIGHT_DURATION_TYPES, refugeeDetailsOptions } from \"./FormAdGuest.data\";\nvar Boolean;\n\n(function (Boolean) {\n  Boolean[\"FALSE\"] = \"FALSE\";\n  Boolean[\"TRUE\"] = \"TRUE\";\n})(Boolean || (Boolean = {}));\n\nvar Location;\n\n(function (Location) {\n  Location[Location[\"Any\"] = 0] = \"Any\";\n  Location[Location[\"Preferred\"] = 1] = \"Preferred\";\n})(Location || (Location = {}));\n\nvar submitRequestDefualtState = {\n  loading: false,\n  error: null,\n  succeeded: false\n};\nexport default function FormAdGuest(_ref) {\n  var _errors$advancedRefug, _errors$advancedRefug2, _errors$advancedRefug3, _errors$advancedRefug4, _errors$advancedRefug5, _errors$advancedRefug6, _errors$advancedRefug7;\n\n  var name = _ref.name,\n      email = _ref.email,\n      phoneNumber = _ref.phoneNumber,\n      data = _ref.data;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useAddGuestToApi = useAddGuestToApi(),\n      mutateAdd = _useAddGuestToApi.mutate;\n\n  var _useUpdateGuestToApi = useUpdateGuestToApi(),\n      mutateUpdate = _useUpdateGuestToApi.mutate;\n\n  var _useState = useState(Location.Any),\n      _useState2 = _slicedToArray(_useState, 2),\n      location = _useState2[0],\n      setLocation = _useState2[1];\n\n  var _useState3 = useState(submitRequestDefualtState),\n      _useState4 = _slicedToArray(_useState3, 2),\n      submitRequstState = _useState4[0],\n      setSubmitRequstState = _useState4[1];\n\n  var formFields = useForm({\n    mode: \"onChange\",\n    defaultValues: {\n      advancedRefugee: {\n        name: name ? name.split(\" \")[0] : \"\",\n        email: email != null ? email : \"\",\n        phoneNumber: phoneNumber != null ? phoneNumber : \"\",\n        fullBedCount: 1,\n        childBedCount: 0,\n        age: 18,\n        accommodationType: []\n      }\n    }\n  });\n  useEffect(function () {\n    if (formFields && data) {\n      formFields.reset({\n        advancedRefugee: {\n          country: data != null && data.country ? data.country : \"\",\n          town: data != null && data.city ? data.city : \"\",\n          overnightDuration: data != null && data.duration_category ? data.duration_category[0] : \"\",\n          fullBedCount: data != null && data.beds ? data.beds : 1,\n          preferences: {\n            peopleDetails: {\n              pregnant: (data == null ? void 0 : data.is_pregnant) === Boolean.TRUE,\n              disability: (data == null ? void 0 : data.is_with_disability) === Boolean.TRUE,\n              animals: (data == null ? void 0 : data.is_with_animal) === Boolean.TRUE,\n              oldPerson: (data == null ? void 0 : data.is_with_elderly) === Boolean.TRUE\n            }\n          },\n          groupRelations: data != null && data.group_relation ? data.group_relation[0] : \"\",\n          accommodationType: data != null && data.acceptable_shelter_types ? data.acceptable_shelter_types : [],\n          nationality: (data == null ? void 0 : data.is_ukrainian_nationality) === Boolean.TRUE ? Nationality.UKRAINIAN : (data == null ? void 0 : data.is_ukrainian_nationality) === Boolean.FALSE ? Nationality.ANY : \"\",\n          phoneNumber: data != null && data.phone_num ? data.phone_num : \"\",\n          email: data != null && data.email ? data.email : \"\"\n        }\n      });\n    }\n  }, [data, formFields]);\n  useEffect(function () {\n    if (data != null && data.city && location === Location.Any) {\n      setLocation(Location.Preferred);\n    }\n  }, [data, location]);\n  var handleSubmit = formFields.handleSubmit,\n      watch = formFields.watch,\n      _formFields$formState = formFields.formState,\n      errors = _formFields$formState.errors,\n      isValid = _formFields$formState.isValid,\n      isSubmitted = _formFields$formState.isSubmitted;\n  var watchCountry = watch(\"advancedRefugee.country\", \"\");\n  var getSubmitButtonTitle = useMemo(function () {\n    return data != null && data.id ? t(\"refugeeAddForm.confirmChangesButton\") : t(\"refugeeAddForm.addButton\");\n  }, [t, data]);\n  var onChooseLocation = useCallback(function (newLocation) {\n    return function _callee() {\n      var result;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(newLocation === Location.Preferred)) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(formFields.trigger(\"advancedRefugee.country\"));\n\n            case 3:\n              result = _context.sent;\n              result ? setLocation(newLocation) : \"\";\n              _context.next = 8;\n              break;\n\n            case 7:\n              setLocation(newLocation);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n  }, [formFields]);\n\n  var onSubmit = function onSubmit(_ref2) {\n    var advancedRefugee, guest, apiObject, mutate;\n    return _regeneratorRuntime.async(function onSubmit$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            advancedRefugee = _ref2.advancedRefugee;\n            guest = advancedRefugee;\n            apiObject = {\n              id: data != null && data.id ? data.id : undefined,\n              phone_num: \"\" + guest.phoneNumber,\n              email: guest.email,\n              acceptable_shelter_types: guest.accommodationType,\n              beds: guest.fullBedCount,\n              group_relation: [guest.groupRelations],\n              is_pregnant: guest.preferences.peopleDetails.pregnant ? Boolean.TRUE : Boolean.FALSE,\n              is_with_disability: guest.preferences.peopleDetails.disability ? Boolean.TRUE : Boolean.FALSE,\n              is_with_animal: guest.preferences.peopleDetails.animals ? Boolean.TRUE : Boolean.FALSE,\n              is_with_elderly: guest.preferences.peopleDetails.oldPerson ? Boolean.TRUE : Boolean.FALSE,\n              is_ukrainian_nationality: guest.nationality === Nationality.UKRAINIAN ? Boolean.TRUE : Boolean.FALSE,\n              duration_category: [guest.overnightDuration],\n              country: guest.country\n            };\n\n            if (guest.town) {\n              apiObject = _objectSpread(_objectSpread({}, apiObject), {}, {\n                city: guest.town\n              });\n            }\n\n            mutate = function mutate(payload, callbacks) {\n              if (data != null && data.id) {\n                mutateUpdate(_objectSpread(_objectSpread({}, data), payload), callbacks);\n                return;\n              }\n\n              mutateAdd(payload, callbacks);\n            };\n\n            setSubmitRequstState(function (state) {\n              return _objectSpread(_objectSpread({}, state), {}, {\n                loading: true\n              });\n            });\n            mutate(apiObject, {\n              onSuccess: function onSuccess() {\n                setSubmitRequstState(function (state) {\n                  return _objectSpread(_objectSpread({}, state), {}, {\n                    succeeded: true\n                  });\n                });\n              },\n              onError: function onError(error) {\n                setSubmitRequstState(function (state) {\n                  return _objectSpread(_objectSpread({}, state), {}, {\n                    error: error\n                  });\n                });\n              },\n              onSettled: function onSettled() {\n                setSubmitRequstState(function (state) {\n                  return _objectSpread(_objectSpread({}, state), {}, {\n                    loading: false\n                  });\n                });\n              }\n            });\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var onError = function onError(_error) {};\n\n  return React.createElement(FormProvider, formFields, submitRequstState.loading && React.createElement(CardModal, {\n    closeable: false\n  }, React.createElement(ActivityIndicator, {\n    size: \"large\"\n  })), submitRequstState.succeeded && React.createElement(ThankfulnessModal, {\n    onClose: function onClose() {\n      return setSubmitRequstState(submitRequestDefualtState);\n    },\n    headerText: t(\"thankfulnessModal.thankYou\"),\n    subHeaderText: t(\"thankfulnessModal.applicationSent\"),\n    contentText: t(\"thankfulnessModal.informWhenAccomodationFound\")\n  }), React.createElement(CompositionSection, {\n    zIndex: 5,\n    padding: [35, 30, 8, 30],\n    header: t(\"refugeeAddForm.placeOfRefuge\"),\n    backgroundColor: \"#F5F4F4\"\n  }, React.createElement(SectionContent, null, React.createElement(View, {\n    style: {\n      zIndex: 14\n    }\n  }, React.createElement(InputCotrolLabel, null, t(\"others:forms.createRefuge.shelter.whatIsTargetCountry\")), React.createElement(FormCountryDropdown, {\n    zIndex: 14,\n    placeholder: t(\"refugeeAddForm.countryOfRefugePlaceholder\"),\n    name: \"advancedRefugee.country\",\n    rules: {\n      required: true\n    },\n    error: errors == null ? void 0 : (_errors$advancedRefug = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug.country,\n    errorMsg: t(\"hostAdd.errors.country\")\n  })), React.createElement(View, {\n    style: {\n      zIndex: 13,\n      marginTop: 10\n    }\n  }, React.createElement(InputCotrolLabel, null, t(\"others:forms.createRefuge.shelter.targetCityAndSurroundings\"), React.createElement(View, {\n    style: styles.tooltipText\n  }, React.createElement(Tooltip, null, React.createElement(Text, {\n    style: {\n      zIndex: 99\n    }\n  }, t(\"refugeeAddForm.cityTooltip\"))))), React.createElement(Buttons, {\n    justifyContent: \"space-between\"\n  }, React.createElement(ChoiceButton, {\n    text: t(\"others:forms.createRefuge:shelter.anyCity\"),\n    isSmall: true,\n    onPress: onChooseLocation(Location.Any),\n    isSelected: location === Location.Any,\n    width: 180,\n    noMarginRight: true\n  }), React.createElement(ChoiceButton, {\n    text: t(\"others:forms.match.specificCity\"),\n    isSmall: true,\n    onPress: onChooseLocation(Location.Preferred),\n    isSelected: location === Location.Preferred,\n    width: 180,\n    noMarginRight: true\n  }))), location === Location.Preferred && React.createElement(View, {\n    style: {\n      zIndex: 13\n    }\n  }, React.createElement(FormCityDropdown, {\n    country: watchCountry,\n    name: \"advancedRefugee.town\",\n    placeholder: t(\"refugeeAddForm.cityPlaceholder\"),\n    rules: {\n      required: true\n    },\n    error: errors == null ? void 0 : (_errors$advancedRefug2 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug2.town,\n    errorMsg: t(\"validations.requiredTown\")\n  })), React.createElement(View, {\n    style: {\n      zIndex: 12\n    }\n  }, React.createElement(InputCotrolLabel, null, t(\"refugeeAddForm.overnightDurationLabel\")), React.createElement(FormRadioGroup, {\n    name: \"advancedRefugee.overnightDuration\",\n    rules: {\n      required: true\n    },\n    data: OVERNIGHT_DURATION_TYPES.map(function (_ref3) {\n      var label = _ref3.label,\n          rest = _objectWithoutProperties(_ref3, _excluded);\n\n      return _objectSpread({\n        label: t(label)\n      }, rest);\n    }),\n    error: errors == null ? void 0 : (_errors$advancedRefug3 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug3.overnightDuration,\n    errorMsg: t(\"refugeeAddForm.errors.overnightDuration\")\n  })))), React.createElement(CompositionSection, {\n    zIndex: 2,\n    padding: [35, 30, 8, 30],\n    header: t(\"others:forms.createRefuge:shelter.groupDetails\")\n  }, React.createElement(SectionContent, null, React.createElement(View, {\n    style: {}\n  }, React.createElement(InputCotrolLabel, null, t(\"refugeeAddForm.fullBedCountLabel\")), React.createElement(FormNumericInput, {\n    name: \"advancedRefugee.fullBedCount\",\n    rules: {\n      required: true\n    },\n    min: 1,\n    error: errors == null ? void 0 : (_errors$advancedRefug4 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug4.fullBedCount,\n    errorMsg: t(\"refugeeAddForm.errors.fullBedCount\")\n  })), React.createElement(FormButtonsVertical, {\n    data: refugeeDetailsOptions.map(function (_ref4) {\n      var label = _ref4.label,\n          rest = _objectWithoutProperties(_ref4, _excluded2);\n\n      return _objectSpread({\n        label: t(label)\n      }, rest);\n    })\n  }), React.createElement(View, {\n    style: {\n      zIndex: 11\n    }\n  }, React.createElement(InputCotrolLabel, null, t(\"refugeeAddForm.groupRelations\")), React.createElement(FormDropdown, {\n    data: GROUP_RELATIONS.map(function (_ref5) {\n      var label = _ref5.label,\n          rest = _objectWithoutProperties(_ref5, _excluded3);\n\n      return _objectSpread({\n        label: t(label)\n      }, rest);\n    }),\n    name: \"advancedRefugee.groupRelations\",\n    placeholder: t(\"refugeeAddForm.selectPlaceholder\"),\n    rules: {\n      required: true\n    },\n    error: errors == null ? void 0 : (_errors$advancedRefug5 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug5.groupRelations,\n    errorMsg: t(\"refugeeAddForm.errors.groupRelations\")\n  })), React.createElement(View, {\n    style: {\n      zIndex: 10\n    }\n  }, React.createElement(InputCotrolLabel, null, t(\"refugeeAddForm.accommodationType\")), React.createElement(FormDropdown, {\n    data: ACCOMMODATION_TYPES.map(function (_ref6) {\n      var label = _ref6.label,\n          rest = _objectWithoutProperties(_ref6, _excluded4);\n\n      return _objectSpread({\n        label: t(label)\n      }, rest);\n    }),\n    name: \"advancedRefugee.accommodationType\",\n    placeholder: t(\"refugeeAddForm.selectPlaceholder\"),\n    multiSelect: true,\n    rules: {\n      required: true\n    },\n    error: errors == null ? void 0 : (_errors$advancedRefug6 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug6.accommodationType,\n    errorMsg: t(\"refugeeAddForm.errors.accommodationType\")\n  })), React.createElement(View, {\n    style: {}\n  }, React.createElement(InputCotrolLabel, null, t(\"refugeeAddForm.countryOfGroup\")), React.createElement(FormRadioGroup, {\n    isRadio: true,\n    name: \"advancedRefugee.nationality\",\n    rules: {\n      required: true\n    },\n    data: [{\n      label: t(\"refugeeAddForm.countryOfGroupUA\"),\n      value: Nationality.UKRAINIAN\n    }, {\n      label: t(\"refugeeAddForm.countryOfGroupOthers\"),\n      value: Nationality.ANY\n    }],\n    error: errors == null ? void 0 : (_errors$advancedRefug7 = errors.advancedRefugee) == null ? void 0 : _errors$advancedRefug7.nationality,\n    errorMsg: t(\"refugeeAddForm.errors.countryOfGroup\")\n  })))), React.createElement(CompositionSection, {\n    zIndex: 1,\n    padding: [35, 30, 8, 30],\n    backgroundColor: \"#F5F4F4\"\n  }, React.createElement(InputControl, null, React.createElement(ButtonCta, {\n    onPress: handleSubmit(onSubmit, onError),\n    anchor: getSubmitButtonTitle,\n    style: styles.addButton\n  }), isSubmitted && !isValid ? React.createElement(InputError, null, t(\"refugeeAddForm.addButtomErrorMessage\")) : null)));\n}\nvar styles = StyleSheet.create({\n  addButton: {\n    marginBottom: 5\n  },\n  tooltipText: {\n    marginHorizontal: 10\n  }\n});\nexport var SectionContent = styled.View(_templateObject || (_templateObject = _taggedTemplateLiteralLoose([\"\\n  display: flex;\\n  gap: 30px 0;\\n  max-width: 400px;\\n  width: 100%;\\n  margin-right: auto;\\n  margin-left: auto;\\n\"])));","map":{"version":3,"sources":["/Users/stanislav.kovalov/Desktop/uasos/apps/next/src/components/FormAdGuest/index.tsx"],"names":["React","useCallback","useEffect","useMemo","useState","FormProvider","useForm","useTranslation","styled","Nationality","useAddGuestToApi","useUpdateGuestToApi","ButtonCta","CardModal","CompositionSection","ChoiceButton","InputControl","InputCotrolLabel","Buttons","FormButtonsVertical","FormCityDropdown","FormCountryDropdown","FormDropdown","FormNumericInput","FormRadioGroup","Error","InputError","ThankfulnessModal","Tooltip","ACCOMMODATION_TYPES","GROUP_RELATIONS","OVERNIGHT_DURATION_TYPES","refugeeDetailsOptions","Boolean","Location","submitRequestDefualtState","loading","error","succeeded","FormAdGuest","name","email","phoneNumber","data","t","mutateAdd","mutate","mutateUpdate","Any","location","setLocation","submitRequstState","setSubmitRequstState","formFields","mode","defaultValues","advancedRefugee","split","fullBedCount","childBedCount","age","accommodationType","reset","country","town","city","overnightDuration","duration_category","beds","preferences","peopleDetails","pregnant","is_pregnant","TRUE","disability","is_with_disability","animals","is_with_animal","oldPerson","is_with_elderly","groupRelations","group_relation","acceptable_shelter_types","nationality","is_ukrainian_nationality","UKRAINIAN","FALSE","ANY","phone_num","Preferred","handleSubmit","watch","formState","errors","isValid","isSubmitted","watchCountry","getSubmitButtonTitle","id","onChooseLocation","newLocation","trigger","result","onSubmit","guest","apiObject","undefined","payload","callbacks","state","onSuccess","onError","onSettled","_error","zIndex","required","marginTop","styles","tooltipText","map","label","rest","value","addButton","StyleSheet","create","marginBottom","marginHorizontal","SectionContent","View"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { FormProvider, SubmitHandler, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { ActivityIndicator, StyleSheet, Text, View } from \"react-native\";\nimport styled from \"styled-components/native\";\nimport type { GuestProps as AddGuestProps } from \"../../../pages/api/guests/add\";\nimport type { GuestProps as EditGuestProps } from \"../../../pages/api/guests/edit\";\nimport { FormType, Nationality } from \"../../helpers/FormTypes\";\nimport {\n  useAddGuestToApi,\n  useUpdateGuestToApi,\n} from \"../../queries/useRequestsList\";\nimport { ButtonCta } from \"../Buttons\";\nimport CardModal from \"../CardModal\";\nimport { CompositionSection } from \"../Compositions\";\nimport { ChoiceButton, InputControl, InputCotrolLabel } from \"../Forms\";\nimport { Buttons } from \"../Forms/RadioButtons/style\";\nimport FormButtonsVertical from \"../Inputs/FormButtonsVertcal\";\nimport FormCityDropdown from \"../Inputs/FormCityDropdown\";\nimport FormCountryDropdown from \"../Inputs/FormCountryDropdown\";\nimport FormDropdown from \"../Inputs/FormDropdown\";\nimport FormNumericInput from \"../Inputs/FormNumericInput\";\nimport FormRadioGroup from \"../Inputs/FormRadioGroup\";\nimport { Error as InputError } from \"../Inputs/style\";\nimport { ThankfulnessModal } from \"../ThankfulnessModal\";\nimport { Tooltip } from \"../Tooltip\";\nimport { RequestProps } from \"../../../pages/api/listing/requests\";\nimport {\n  ACCOMMODATION_TYPES,\n  GROUP_RELATIONS,\n  OVERNIGHT_DURATION_TYPES,\n  refugeeDetailsOptions,\n} from \"./FormAdGuest.data\";\n\nenum Boolean {\n  FALSE = \"FALSE\",\n  TRUE = \"TRUE\",\n}\n\nconst enum Location {\n  Any,\n  Preferred,\n}\n\ntype SubmitRequestState = {\n  loading: boolean;\n  error: Error | null | unknown;\n  succeeded: boolean;\n};\nconst submitRequestDefualtState = {\n  loading: false,\n  error: null,\n  succeeded: false,\n};\n\ntype FormAdGuestProps = {\n  name: string | null;\n  email: string | null;\n  phoneNumber: string | null;\n  data: RequestProps | null;\n};\n\ntype MutateCallbacks = {\n  onSuccess: () => void;\n  onError: (error: Error | unknown) => void;\n  onSettled: () => void;\n};\n\nexport default function FormAdGuest({\n  name,\n  email,\n  phoneNumber,\n  data,\n}: FormAdGuestProps) {\n  const { t } = useTranslation();\n  const { mutate: mutateAdd } = useAddGuestToApi();\n  const { mutate: mutateUpdate } = useUpdateGuestToApi();\n  const [location, setLocation] = useState<Location>(Location.Any);\n  const [submitRequstState, setSubmitRequstState] =\n    useState<SubmitRequestState>(submitRequestDefualtState);\n\n  const formFields = useForm<FormType>({\n    mode: \"onChange\",\n    defaultValues: {\n      advancedRefugee: {\n        name: name ? name.split(\" \")[0] : \"\",\n        email: email ?? \"\",\n        phoneNumber: phoneNumber ?? \"\",\n        fullBedCount: 1,\n        childBedCount: 0,\n        age: 18,\n        accommodationType: [],\n      },\n    },\n  });\n\n  useEffect(() => {\n    if (formFields && data) {\n      formFields.reset({\n        advancedRefugee: {\n          country: data?.country ? data.country : \"\",\n          town: data?.city ? data.city : \"\",\n          overnightDuration: data?.duration_category\n            ? data.duration_category[0]\n            : \"\",\n          fullBedCount: data?.beds ? data.beds : 1,\n          preferences: {\n            peopleDetails: {\n              pregnant: data?.is_pregnant === Boolean.TRUE,\n              disability: data?.is_with_disability === Boolean.TRUE,\n              animals: data?.is_with_animal === Boolean.TRUE,\n              oldPerson: data?.is_with_elderly === Boolean.TRUE,\n            },\n          },\n          groupRelations: data?.group_relation ? data.group_relation[0] : \"\",\n          accommodationType: data?.acceptable_shelter_types\n            ? data.acceptable_shelter_types\n            : [],\n          nationality:\n            data?.is_ukrainian_nationality === Boolean.TRUE\n              ? Nationality.UKRAINIAN\n              : data?.is_ukrainian_nationality === Boolean.FALSE\n              ? Nationality.ANY\n              : \"\",\n          phoneNumber: data?.phone_num ? data.phone_num : \"\",\n          email: data?.email ? data.email : \"\",\n        },\n      });\n    }\n  }, [data, formFields]);\n\n  useEffect(() => {\n    if (data?.city && location === Location.Any) {\n      setLocation(Location.Preferred);\n    }\n  }, [data, location]);\n\n  const {\n    handleSubmit,\n    watch,\n    formState: { errors, isValid, isSubmitted },\n  } = formFields;\n\n  const watchCountry = watch(\"advancedRefugee.country\", \"\");\n\n  const getSubmitButtonTitle = useMemo(\n    () =>\n      data?.id\n        ? t(\"refugeeAddForm.confirmChangesButton\")\n        : t(\"refugeeAddForm.addButton\"),\n    [t, data]\n  );\n\n  const onChooseLocation = useCallback(\n    (newLocation: Location) => async () => {\n      if (newLocation === Location.Preferred) {\n        const result = await formFields.trigger(\"advancedRefugee.country\");\n        result ? setLocation(newLocation) : \"\";\n      } else {\n        setLocation(newLocation);\n      }\n    },\n    [formFields]\n  );\n\n  const onSubmit: SubmitHandler<FormType> = async ({ advancedRefugee }) => {\n    const guest = advancedRefugee;\n\n    let apiObject: AddGuestProps | EditGuestProps = {\n      // name: guest.name,\n      id: data?.id ? data.id : undefined,\n      phone_num: `${guest.phoneNumber}`,\n      email: guest.email,\n      acceptable_shelter_types: guest.accommodationType,\n      beds: guest.fullBedCount,\n      group_relation: [guest.groupRelations],\n      is_pregnant: guest.preferences.peopleDetails.pregnant\n        ? Boolean.TRUE\n        : Boolean.FALSE,\n      is_with_disability: guest.preferences.peopleDetails.disability\n        ? Boolean.TRUE\n        : Boolean.FALSE,\n      is_with_animal: guest.preferences.peopleDetails.animals\n        ? Boolean.TRUE\n        : Boolean.FALSE,\n      is_with_elderly: guest.preferences.peopleDetails.oldPerson\n        ? Boolean.TRUE\n        : Boolean.FALSE,\n      is_ukrainian_nationality:\n        guest.nationality === Nationality.UKRAINIAN\n          ? Boolean.TRUE\n          : Boolean.FALSE,\n      duration_category: [guest.overnightDuration],\n      country: guest.country,\n    };\n\n    if (guest.town) {\n      apiObject = {\n        ...apiObject,\n        city: guest.town,\n      };\n    }\n\n    const mutate = (\n      payload: AddGuestProps | EditGuestProps,\n      callbacks: MutateCallbacks\n    ) => {\n      if (data?.id) {\n        mutateUpdate({ ...data, ...payload } as EditGuestProps, callbacks);\n        return;\n      }\n\n      mutateAdd(payload as AddGuestProps, callbacks);\n    };\n\n    setSubmitRequstState((state) => ({ ...state, loading: true }));\n\n    mutate(apiObject, {\n      onSuccess: () => {\n        setSubmitRequstState((state) => ({ ...state, succeeded: true }));\n      },\n      onError: (error) => {\n        setSubmitRequstState((state) => ({ ...state, error }));\n      },\n      onSettled: () => {\n        setSubmitRequstState((state) => ({ ...state, loading: false }));\n      },\n    });\n  };\n\n  const onError = (_error: unknown) => {\n    // TODO: handle error case\n  };\n\n  return (\n    <FormProvider {...formFields}>\n      {submitRequstState.loading && (\n        <CardModal closeable={false}>\n          <ActivityIndicator size=\"large\" />\n        </CardModal>\n      )}\n\n      {/* TODO: Form error handling submitRequstState.error && ... */}\n\n      {submitRequstState.succeeded && (\n        <ThankfulnessModal\n          onClose={() => setSubmitRequstState(submitRequestDefualtState)}\n          headerText={t(\"thankfulnessModal.thankYou\")}\n          subHeaderText={t(\"thankfulnessModal.applicationSent\")}\n          contentText={t(\"thankfulnessModal.informWhenAccomodationFound\")}\n        />\n      )}\n\n      <CompositionSection\n        zIndex={5}\n        padding={[35, 30, 8, 30]}\n        header={t(\"refugeeAddForm.placeOfRefuge\")}\n        backgroundColor=\"#F5F4F4\"\n      >\n        <SectionContent>\n          <View style={{ zIndex: 14 }}>\n            <InputCotrolLabel>\n              {t(\"others:forms.createRefuge.shelter.whatIsTargetCountry\")}\n            </InputCotrolLabel>\n            <FormCountryDropdown\n              zIndex={14}\n              placeholder={t(\"refugeeAddForm.countryOfRefugePlaceholder\")}\n              name=\"advancedRefugee.country\"\n              rules={{\n                required: true,\n              }}\n              error={errors?.advancedRefugee?.country}\n              errorMsg={t(\"hostAdd.errors.country\")}\n            />\n          </View>\n          <View style={{ zIndex: 13, marginTop: 10 }}>\n            <InputCotrolLabel>\n              {t(\"others:forms.createRefuge.shelter.targetCityAndSurroundings\")}\n              <View style={styles.tooltipText}>\n                <Tooltip>\n                  <Text style={{ zIndex: 99 }}>\n                    {t(\"refugeeAddForm.cityTooltip\")}\n                  </Text>\n                </Tooltip>\n              </View>\n            </InputCotrolLabel>\n            <Buttons justifyContent={\"space-between\"}>\n              <ChoiceButton\n                text={t(\"others:forms.createRefuge:shelter.anyCity\")}\n                isSmall\n                onPress={onChooseLocation(Location.Any)}\n                isSelected={location === Location.Any}\n                width={180}\n                noMarginRight\n              />\n              <ChoiceButton\n                text={t(\"others:forms.match.specificCity\")}\n                isSmall\n                onPress={onChooseLocation(Location.Preferred)}\n                isSelected={location === Location.Preferred}\n                width={180}\n                noMarginRight\n              />\n            </Buttons>\n          </View>\n          {location === Location.Preferred && (\n            <View style={{ zIndex: 13 }}>\n              <FormCityDropdown\n                country={watchCountry}\n                name=\"advancedRefugee.town\"\n                placeholder={t(\"refugeeAddForm.cityPlaceholder\")}\n                rules={{\n                  required: true,\n                }}\n                error={errors?.advancedRefugee?.town}\n                errorMsg={t(\"validations.requiredTown\")}\n              />\n            </View>\n          )}\n          <View style={{ zIndex: 12 }}>\n            <InputCotrolLabel>\n              {t(\"refugeeAddForm.overnightDurationLabel\")}\n            </InputCotrolLabel>\n            <FormRadioGroup\n              name=\"advancedRefugee.overnightDuration\"\n              rules={{\n                required: true,\n              }}\n              data={OVERNIGHT_DURATION_TYPES.map(({ label, ...rest }) => ({\n                label: t(label),\n                ...rest,\n              }))}\n              error={errors?.advancedRefugee?.overnightDuration}\n              errorMsg={t(\"refugeeAddForm.errors.overnightDuration\")}\n            />\n          </View>\n        </SectionContent>\n      </CompositionSection>\n      <CompositionSection\n        zIndex={2}\n        padding={[35, 30, 8, 30]}\n        header={t(\"others:forms.createRefuge:shelter.groupDetails\")}\n      >\n        <SectionContent>\n          <View style={{}}>\n            <InputCotrolLabel>\n              {t(\"refugeeAddForm.fullBedCountLabel\")}\n            </InputCotrolLabel>\n            <FormNumericInput\n              name=\"advancedRefugee.fullBedCount\"\n              rules={{\n                required: true,\n              }}\n              min={1}\n              error={errors?.advancedRefugee?.fullBedCount}\n              errorMsg={t(\"refugeeAddForm.errors.fullBedCount\")}\n            />\n          </View>\n          <FormButtonsVertical\n            data={refugeeDetailsOptions.map(({ label, ...rest }) => ({\n              label: t(label),\n              ...rest,\n            }))}\n          />\n          <View style={{ zIndex: 11 }}>\n            <InputCotrolLabel>\n              {t(\"refugeeAddForm.groupRelations\")}\n            </InputCotrolLabel>\n            <FormDropdown\n              data={GROUP_RELATIONS.map(({ label, ...rest }) => ({\n                label: t(label),\n                ...rest,\n              }))}\n              name=\"advancedRefugee.groupRelations\"\n              placeholder={t(\"refugeeAddForm.selectPlaceholder\")}\n              rules={{\n                required: true,\n              }}\n              error={errors?.advancedRefugee?.groupRelations}\n              errorMsg={t(\"refugeeAddForm.errors.groupRelations\")}\n            />\n          </View>\n          <View style={{ zIndex: 10 }}>\n            <InputCotrolLabel>\n              {t(\"refugeeAddForm.accommodationType\")}\n            </InputCotrolLabel>\n            <FormDropdown<string>\n              data={ACCOMMODATION_TYPES.map(({ label, ...rest }) => ({\n                label: t(label),\n                ...rest,\n              }))}\n              name=\"advancedRefugee.accommodationType\"\n              placeholder={t(\"refugeeAddForm.selectPlaceholder\")}\n              multiSelect\n              rules={{\n                required: true,\n              }}\n              error={errors?.advancedRefugee?.accommodationType}\n              errorMsg={t(\"refugeeAddForm.errors.accommodationType\")}\n            />\n          </View>\n\n          <View style={{}}>\n            <InputCotrolLabel>\n              {t(\"refugeeAddForm.countryOfGroup\")}\n            </InputCotrolLabel>\n            <FormRadioGroup\n              isRadio\n              name=\"advancedRefugee.nationality\"\n              rules={{\n                required: true,\n              }}\n              data={[\n                {\n                  label: t(\"refugeeAddForm.countryOfGroupUA\"),\n                  value: Nationality.UKRAINIAN,\n                },\n                {\n                  label: t(\"refugeeAddForm.countryOfGroupOthers\"),\n                  value: Nationality.ANY,\n                },\n              ]}\n              error={errors?.advancedRefugee?.nationality}\n              errorMsg={t(\"refugeeAddForm.errors.countryOfGroup\")}\n            />\n          </View>\n        </SectionContent>\n      </CompositionSection>\n      <CompositionSection\n        zIndex={1}\n        padding={[35, 30, 8, 30]}\n        backgroundColor=\"#F5F4F4\"\n      >\n        <InputControl>\n          <ButtonCta\n            onPress={handleSubmit(onSubmit, onError)}\n            anchor={getSubmitButtonTitle}\n            style={styles.addButton}\n          />\n          {isSubmitted && !isValid ? (\n            <InputError>{t(\"refugeeAddForm.addButtomErrorMessage\")}</InputError>\n          ) : null}\n        </InputControl>\n      </CompositionSection>\n    </FormProvider>\n  );\n}\n\nconst styles = StyleSheet.create({\n  addButton: {\n    marginBottom: 5,\n  },\n  tooltipText: {\n    marginHorizontal: 10,\n  },\n});\n\nexport const SectionContent = styled.View`\n  display: flex;\n  gap: 30px 0;\n  max-width: 400px;\n  width: 100%;\n  margin-right: auto;\n  margin-left: auto;\n`;\n"]},"metadata":{},"sourceType":"module"}