{"version":3,"file":"ChromeIconsWebpackPlugin.js","sourceRoot":"","sources":["../../src/plugins/ChromeIconsWebpackPlugin.ts"],"names":[],"mappings":";;;;;AAAA,kDAA0B;AAC1B,uCAAgF;AAIhF,wFAAgE;AAShE,SAAS,SAAS,CAAC,IAAY,EAAE,OAAe;IAC9C,OAAO,CAAC,GAAG,CAAC,eAAK,CAAC,OAAO,CAAC,UAAU,IAAI,KAAK,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;AACvE,CAAC;AACD,SAAS,UAAU,CAAC,IAAY,EAAE,OAAe;IAC/C,OAAO,CAAC,GAAG,CAAC,eAAK,CAAC,MAAM,CAAC,UAAU,IAAI,KAAK,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;AACtE,CAAC;AAED,MAAqB,wBAAyB,SAAQ,iCAAuB;IAC3E,uEAAuE;IACvE,YAAoB,OAAuB,EAAU,IAAwB;QAC3E,0BAA0B;QAC1B,KAAK,EAAE,CAAC;QAFU,YAAO,GAAP,OAAO,CAAgB;QAAU,SAAI,GAAJ,IAAI,CAAoB;IAG7E,CAAC;IAED,KAAK,CAAC,WAAW,CACf,QAAkB,EAClB,WAAsC,EACtC,IAAuB;QAEvB,oEAAoE;QACpE,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YAClC,SAAS,CAAC,cAAc,EAAE,0CAA0C,CAAC,CAAC;YACtE,OAAO,IAAI,CAAC;SACb;QACD,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;YACd,UAAU,CAAC,cAAc,EAAE,sDAAsD,CAAC,CAAC;YACnF,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAErB,MAAM,UAAU,GAAG,MAAM,kCAAuB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAE9E,KAAK,MAAM,KAAK,IAAI,UAAU,EAAE;YAC9B,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG;gBACrC,MAAM,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM;gBAChC,IAAI,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM;aACtC,CAAC;YAEF,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;SACtC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AArCD,2CAqCC","sourcesContent":["import chalk from 'chalk';\nimport { generateChromeIconAsync, IconOptions, ProjectOptions } from 'expo-pwa';\nimport { compilation as compilationNS, Compiler } from 'webpack';\n\nimport { BeforeEmitOptions } from './JsonWebpackPlugin';\nimport ModifyJsonWebpackPlugin from './ModifyJsonWebpackPlugin';\n\nexport type Options = {\n  source: string;\n  outputPath?: string;\n  backgroundColor?: string;\n  resizeMode?: 'contain' | 'cover';\n};\n\nfunction logNotice(type: string, message: string) {\n  console.log(chalk.magenta(`\\u203A ${type}: ${chalk.gray(message)}`));\n}\nfunction logWarning(type: string, message: string) {\n  console.log(chalk.yellow(`\\u203A ${type}: ${chalk.gray(message)}`));\n}\n\nexport default class ChromeIconsWebpackPlugin extends ModifyJsonWebpackPlugin {\n  // Maybe we should support the ability to create all icons individually\n  constructor(private options: ProjectOptions, private icon: IconOptions | null) {\n    // TODO(Bacon): Validation\n    super();\n  }\n\n  async modifyAsync(\n    compiler: Compiler,\n    compilation: compilationNS.Compilation,\n    data: BeforeEmitOptions\n  ): Promise<BeforeEmitOptions> {\n    // If the icons array is already defined, then skip icon generation.\n    if (Array.isArray(data.json.icons)) {\n      logNotice('Chrome Icons', `Using custom \\`icons\\` from PWA manifest`);\n      return data;\n    }\n    if (!this.icon) {\n      logWarning('Chrome Icons', `No template image found, skipping auto generation...`);\n      return data;\n    }\n\n    data.json.icons = [];\n\n    const iconAssets = await generateChromeIconAsync(this.options, this.icon, {});\n\n    for (const asset of iconAssets) {\n      compilation.assets[asset.asset.path] = {\n        source: () => asset.asset.source,\n        size: () => asset.asset.source.length,\n      };\n\n      data.json.icons.push(asset.manifest);\n    }\n\n    return data;\n  }\n}\n"]}